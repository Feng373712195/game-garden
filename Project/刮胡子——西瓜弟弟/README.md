# 《剃胡子》

《剃胡子》游戏源码

游戏使用白鹭引擎制作，有兴趣的朋友请在egret wing打开。

初次写游戏代码写的不好，勿喷～ 嘻嘻。

---

## 介绍文章

[小游戏之《剃胡子》](http://wuzefeng.cn/article/5e7f1eaed739af775d53ebca)


p2.js文档
https://schteppe.github.io/p2.js/docs/classes/World.html

参考文章
egret监听时间事件 https://www.codeleading.com/article/94442207659/
egret中使用p2.js https://blog.csdn.net/qilei2010/article/details/51925754

##

- 游戏讨喜度
    - 画面增加彩色
    - UI改为彩色UI （风格参考头脑风暴）
    - 增加排行榜，前20名会展示， 会有你的分数超越了百分之多少人 (增加再次游戏可能性)

- 增加游戏喜感度
    - 游戏角色疼痛叫声 （暂时定有三种程度的叫声）
    - 游戏在一定时间剔除一定数量胡子，完成后猥琐表情 （可能配合下面说的抖屏效果）
    - 胡子长重新出来时有一些弹性动画

- 如何使游戏过程更爽快
    - 增加音效
    - 会出现滑动胡子 增加数字 比如 ： +1 +1 +1
    - 到达一定分数会有抖屏效果
    - 增强剃的效果 （剔除时胡子渣按方向喷飞）

- 解决游戏性单一问题
    - 多种类胡子，需要多次才能拔掉
        - 卷毛胡子 需要滑动两次才可以清除，获得分数为二级
        - 硬毛胡子 需要滑动三次才可以清除，获得分数为三级

- 胡子生成更加好看
    - 遍布的范围
    - 胡子的方向


## TodoList

- View命名的变量改为Screen

- 解决胡子分布问题，方向，数量优化，重新长出来的动画效果，（是否要做成对象池）
    - 胡子生长角度问题 (处理)
    - 胡子长出动画 (处理)
    - 胡子对象池  （游戏优化 处理）
    - 增加胡子数量 (遍布太多胡子 ｜ 会引起密集恐惧的效果，测试在70/100根以内最佳。之前最大满意数量300)
    - 遍布问题处理 (分布不重叠，尽量均匀 ｜ 提高了生成脸Y轴高度)

- 胡子剃掉后喷飞效果
    性能问题考虑 （暂无体验到大的性能）
    动画流畅度   (处理 ｜ 目前感觉流程度还可以，计算是跟着帧走的)
    喷飞胡子测试 （处理 ｜禁止触发事件之类）
    胡子方向问题 （处理 ｜用触碰位置判断）

- 游戏主角绘制调整（想法）

- 点击胡子范围优化 （现在太大）(处理)

- 剃须刀音效 （处理）

- 主角尖叫音效 （处理）

- 最后解决UI问题

- 排行榜功能

- 玩法改进A（想法）

    A
    一开始胡子增长速度一般 生长的也是普通胡子渣 玩家在最开始规定时间 在胡子还没生长出来时剔除所有胡子 增加游戏时长 进入下一波
    接下来会有第二波 第三波 胡子长的速度越来越快 而且还有出现奇奇怪怪的胡子 比如上面的刚毛胡子 和 卷毛胡子...

    B
    触摸手势变成一个大的圆圈，为擦出范围

    C
    擦除加入节奏元素

    D
    比如在一秒内剔除了100条胡子，这是比较困难的，主角会出现舒服的表情与配音，屏幕出现perfet和抖动


- 文章介绍实现过程

    - 胡子方向
    - 胡子随机生成
    - 胡子剔除效果
    - 胡子对象池

- 04-03 发现问题

    剔除胡子范围太小 （暂时解决，使用了扩大胡须的点击范围圈的解决方案）
    胡子重叠范围触发不到 （暂时完成，使用了扩大胡须的点击范围圈的解决方案）
    主角增加眨眼和呼吸动画 (暂时完成,可能还需要完成重新开始销毁动画的处理,在函数中返回出绘制对象...)
    胡子生成范围扩展到嘴巴附近，但是不能在嘴边那里生成 （暂时完成，提高生产的y轴，但是不超过胡子皮肤部分）
    胡子怎么好看一点？？？（是个问题，目前解决方案不要遍布的太茂密太密集，然后胡子生成会随着y轴增长长度，越到下巴部分越长）

    解决问题

    胡子对象池 （处理）
    好像胡子越玩越少 (暂时处理 ｜ 待调整)

    销毁处理 （重新游戏 ｜ 返回菜单）
    游戏特效 （pefect提示 ｜ 角色猥琐表情 ｜屏幕抖动）
    游戏音效 （角色叫声 ｜ 角色舒服叫声 ｜ 剃须刀声音 ｜ 游戏背景音(菜单界面) ｜ 游戏背景音（游戏进行）｜ 按钮点击音效 ）
    好像快速滑动没有效果（事件捕获问题？准备改用hitTest方案处理），分数只能一分一分的加（待排查）？（移动端效果不佳）
    游戏待再优化（游戏进行时会有掉帧）
    UI优化

    移出脸部取消剃须刀声 （处理）
    结果窗口出来后 脸不能不能触发touch事件 （处理）

- 04-05 发现问题

    游戏玩法确定 ok

    胡须清除优化 （在移动端效果不太好）

    touchBeard 回调传递分数 （现在每次触发touchBeard不止加1分）

    声音控制 （控制音乐的开关）

    排行榜

- 04-07 整理代码

    排行榜

    后台 ——
        - 接口 —— 参数  （ 昵称 ，时间，分数 ）
        - 判断是否进入排行榜 分数

    前台  —— 第一次 游戏挑战进排行榜 提示弹窗 要求输入昵称 （第一次输入过后 缓存记录）
          —— 如果排行榜空缺 会提示你是第几位开始游戏的 也会记录排行榜 让更多人来挑战你
          —— 之后无需输入昵称 在结果弹窗提示
          —— 排行榜列表
          —— Loading

- 04-08

    restart 没有准备动画出现 ok
    游戏返回后仍在执行 ok
    排行榜提交测试 ok

    名字验证  敏感字 非法字符处理

    服务器部署

    代码上传并可预览
    windows 系统测试
    游戏时间恢复为15秒

- 04-09

    再多加测试！！！
    鼠标右后剃须声音未停

    https证书
    部署到Github Pages

// return new Promise(resolve=>{
//     let beardIndex = -1;
//     this.beards.forEach((i,index)=>{ if(i.shape === beard) beardIndex = index });
//     this.beards[beardIndex].drop = true;
//     beard.$touchEnabled = false;
//     // 清除监听事件
//     beard.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchBeard,beard);
//     beard.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchBeard,beard);
//     // 等待物理动画执行完毕
//     var timer = setTimeout(()=>{
//         this.beards.forEach((i,index)=>{ if(i.shape === beard) beardIndex = index });
//         const beardItem = this.beards[beardIndex]
//         // 清除动画
//         egret.Tween.removeTweens(beardItem.line);
//         // 从画布上消失
//         beard.parent.removeChild(beard);
//         // 删除刚体
//         this.word.removeBody(this.beards[beardIndex].body);
//         // 从数组中清除
//         this.beards.splice(beardIndex,1);
//         // 通知回收
//         beard = null;
//         clearTimeout(timer);
//         resolve();
//     },600);
// })
